.:53 {
    errors
    health {
        lameduck 5s
    }
    ready
    rewrite name idp.lab.local keycloak.keycloak-system.svc.cluster.local
    rewrite name argocd.lab.local argocd.argocd.svc.cluster.local
    rewrite name webmail.lab.local snappymail-service.snappymail-system.svc.cluster.local
    rewrite name stalwart.lab.local stalwart-service.stalwart-system.svc.cluster.local
    kubernetes cluster.local in-addr.arpa ip6.arpa {
        pods insecure
        fallthrough in-addr.arpa ip6.arpa
        ttl 30
    }
    prometheus :9153
    forward . /etc/resolv.conf {
        max_concurrent 1000
    }
    cache 30 {
        disable success cluster.local
        disable denial cluster.local
    }
    loop
    reload
    loadbalance
}
org1.com:53 {
    errors
    cache 30
    forward . 10.109.47.194
    reload
}
# Conditional forwarder for org2.com
org2.com:53 {
    errors
    cache 30
    forward . 10.109.47.194
    reload
}
